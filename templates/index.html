<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IP Intelligence & Geolocation Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        /* ğŸŒˆ Global Design Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: "Poppins", sans-serif;
            background: linear-gradient(135deg, #5fa1f1, #fff);
            color: #333;
            min-height: 100vh;
        }

        /* ğŸŒŸ Header */
        header {
            text-align: center;
            padding: 30px;
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        header h1 {
            font-size: 2rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        header p {
            font-size: 0.9rem;
            color: #f0f0f0;
        }

        /* ğŸ”˜ Button */
        button {
            padding: 12px 28px;
            font-size: 16px;
            display: block;
            margin: 30px auto;
            color: white;
            background: linear-gradient(90deg, #00b09b, #96c93d);
            border: none;
            border-radius: 30px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
        }

        /* ğŸ“Š Layout Wrapper */
        .content-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            width: 90%;
            margin: 0 auto 50px auto;
            gap: 25px;
            flex-wrap: wrap;
        }

        /* ğŸ§¾ IP Info Card */
        #ipInfo {
            flex: 1;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(8px);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            white-space: pre-wrap;
            font-size: 15px;
            height: 460px;
            overflow-y: auto;
            transition: transform 0.2s ease;
        }
        #ipInfo:hover {
            transform: scale(1.01);
        }

        /* ğŸ—ºï¸ Map Section */
        #map {
            flex: 1.2;
            height: 460px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            overflow: hidden;
            transition: transform 0.2s ease;
        }
        #map:hover {
            transform: scale(1.01);
        }

        /* ğŸ§  Footer */
        footer {
            text-align: center;
            padding: 15px;
            color: #fff;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.2);
        }

        /* ğŸ“± Responsive */
        @media (max-width: 900px) {
            .content-wrapper {
                flex-direction: column;
                align-items: center;
            }
            #ipInfo, #map {
                width: 100%;
                height: 400px;
            }
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸŒ IP Intelligence & Geolocation Tracker</h1>
    <p>A final-year project showcasing real-time IP lookups and mapping visualization</p>
</header>

<button onclick="getIPInfo()">ğŸ” Get My IP Info</button>

<div class="content-wrapper">
    <pre id="ipInfo">Click â€œGet My IP Infoâ€ to retrieve your network data...</pre>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // Initialize the map
    const map = L.map('map').setView([0, 0], 2);

    // Use a soft light basemap
    L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);
    //pa add ako ng bago
    let marker;

    function getIPInfo() {
        fetch("/ipinfo")
            .then(response => response.json())
            .then(data => {
                const isRealData = !(parseFloat(data.Latitude) === 0 && parseFloat(data.Longitude) === 0);
                const lat = parseFloat(data.Latitude);
                const lon = parseFloat(data.Longitude);

                const output = `
ğŸŒ IPv4: ${data["IPv4 Address"] || "N/A"}
ğŸ§­ IPv6: ${data["IPv6 Address"] || "N/A"}
ğŸ™ï¸ City: ${data.City || "N/A"}
ğŸ“ Region: ${data.Region || "N/A"}
ğŸŒ Country: ${data.Country || "N/A"} (${data["Country Code"] || "N/A"})
ğŸ¤ Postal: ${data.Postal || "N/A"}
ğŸ—ºï¸ Coordinates: ${lat}, ${lon}
â° Timezone: ${data.Timezone || "N/A"}
ğŸ¢ Organization: ${data.Organization || "N/A"}
ğŸ’» ASN: ${data.ASN || "N/A"}
âš¡ IP Type: ${data["IP Version"] || "N/A"}
ğŸ“¶ Data Status: ${isRealData ? "âœ… Real Data" : "âš ï¸ Fallback Data"}
                `;

                document.getElementById("ipInfo").textContent = output;

                const infoContent = `
<b>IPv4:</b> ${data["IPv4 Address"] || "N/A"}<br>
<b>IPv6:</b> ${data["IPv6 Address"] || "N/A"}<br>
<b>Org:</b> ${data.Organization || "N/A"}<br>
<b>ASN:</b> ${data.ASN || "N/A"}
                `;

                if (marker) {
                    marker.setLatLng([lat, lon]);
                    marker.bindPopup(infoContent).openPopup();
                } else {
                    const icon = L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
                        shadowUrl: 'https://unpkg.com/leaflet/dist/images/marker-shadow.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowSize: [41, 41]
                    });
                    marker = L.marker([lat, lon], {icon: icon})
                        .addTo(map)
                        .bindPopup(infoContent)
                        .openPopup();
                }

                map.setView([lat, lon], 5);
            })
            .catch(err => {
                document.getElementById("ipInfo").textContent = "âš ï¸ Error fetching IP info. Please try again.";
                console.error(err);
            });
    }
</script>

</body>
</html>